# 台指期程式交易看盤室 - 股票城市

## 📊 專案簡介

這是一個基於 Streamlit 開發的台指期貨即時看盤系統，提供互動式 K 線圖表、技術指標分析和多時段交易視圖。適合程式交易員用於快速分析市場走勢、回測策略和監控盤勢。

**主要程式**: `streamlit_run_app.py`

## ✨ 主要功能

### 📈 多商品支援
- **台指期貨模擬**：使用台灣加權指數 (^TWII) 模擬台指期走勢
- **台積電 (2330.TW)**：台灣最具代表性的個股
- **台灣加權指數 (^TWII)**：觀察整體市場表現

### ⏰ 交易時段切換
- **全盤**：顯示所有交易時段資料
- **日盤**：08:45 - 13:45（一般交易時段）
- **夜盤**：15:00 - 次日 05:00（夜間交易時段）

### 📊 K 線週期選擇
- 分鐘線：1m, 5m, 15m, 30m, 60m
- **日線 (預設)**：適合中長期趨勢分析，自動過濾週末非交易日

### 📏 K 棒數量控制
- **靈活調整**：使用滑桿設定顯示的 K 棒數量（20-500 根）
- **預設值**：100 根 K 棒，平衡性能與資訊量
- **智能資料管理**：根據不同週期自動調整下載期間
  - 日K：2 年資料
  - 30/60分K：60 天資料
  - 15分K：30 天資料
  - 1/5分K：7 天資料

### 📐 技術指標
- **10日均線 (MA10)**：橘色線，短期趨勢指標
- **20日均線 (MA20)**：紫色線，中期趨勢指標
- **成交量柱狀圖**：紅綠配色符合台灣習慣（紅漲綠跌）

### 🖱️ 互動式圖表
- **拖曳平移**：左右拖動查看不同時間段
- **滾輪縮放**：放大縮小查看細節
- **十字線提示**：滑鼠懸停顯示詳細數據
- **自動移除非交易日**：週末和假日不顯示，圖表更緊湊
- **深色主題**：專業看盤軟體風格，降低眼睛疲勞

### 💹 即時報價資訊
- 最新收盤價
- 10日均線數值
- 20日均線數值
- 最新成交量

## 🛠️ 技術架構

### 核心技術
- **Streamlit**：Web 應用框架
- **Plotly**：互動式圖表庫
- **yfinance**：Yahoo Finance 數據接口
- **Pandas**：數據處理與分析

### 資料來源
- 目前使用 Yahoo Finance API 獲取歷史數據
- 建議實戰使用 **Shioaji API** 接收即時 Tick 資料

## 🚀 快速開始

### 環境需求
- Python 3.9+
- 網路連線（用於下載數據）

### 安裝步驟

1. **克隆專案**
```bash
git clone <repository-url>
cd stick_strategy
```

2. **建立虛擬環境**
```bash
python -m venv venv_new
```

3. **啟動虛擬環境**
```bash
# Windows
.\venv_new\Scripts\Activate.ps1

# Linux/Mac
source venv_new/bin/activate
```

4. **安裝依賴套件**
```bash
pip install -r requirements.txt
```

### 執行應用程式

```bash
# 使用 venv_new 環境執行
streamlit run streamlit_run_app.py
```

應用程式會在瀏覽器自動開啟，預設網址：
- 本地：http://localhost:8501 或 http://localhost:8502
- 網絡：http://192.168.x.x:8501

## 📁 專案結構

```
stick_strategy/
│
├── streamlit_run_app.py       # 主應用程式（股票城市 - 最新版）
├── streamlit_app_new.py       # 另一版本應用程式
├── streamlit_app_backup.py    # 備份版本
├── tsmc_kline.py              # TSMC K線相關程式
├── tsmc_ticks.py              # TSMC Tick 資料處理
├── test_yfinance.py           # yfinance 測試程式
├── requirements.txt           # Python 依賴套件
├── venv_new/                  # 虛擬環境目錄
└── README.md                  # 專案說明文件（本文件）
```

## 💻 程式架構說明

### streamlit_run_app.py 核心結構

```python
# 1. 頁面初始化設定
- 設定頁面配置和標題

# 2. 側邊欄控制項
- 商品選擇（台指期/台積電/加權指數）
- 時段選擇（全盤/日盤/夜盤）
- K線週期選擇（1m-1d）
- K棒數量滑桿（20-500根）

# 3. 數據獲取與處理
- get_ticker_symbol(): 轉換商品名稱為股票代碼
- filter_by_session(): 根據時段過濾數據
- get_data(): 下載並處理 K 線數據
  * 智能調整下載期間
  * 時區轉換（台灣時間）
  * 過濾非交易日
  * 計算技術指標（MA10/MA20）

# 4. 主程式執行
- 呼叫 get_data() 獲取數據
- 根據設定限制 K 棒數量

# 5. 視覺化繪製
- 建立雙軸圖表（K線+成交量）
- 繪製 K 棒（紅漲綠跌）
- 繪製均線（MA10/MA20）
- 繪製成交量柱狀圖
- 深色主題美化
- 顯示最新報價資訊
```

### 關鍵技術特點

1. **資料快取機制**：使用 `@st.cache_data(ttl=60)` 減少重複請求
2. **時區處理**：自動轉換為台灣時區（Asia/Taipei）
3. **非交易時間過濾**：
   - 日K 自動移除週末
   - 分鐘K 支援日盤/夜盤時段過濾
4. **錯誤處理**：完整的 try-except 機制保證穩定性
5. **響應式設計**：圖表自動適應瀏覽器寬度

## 🎯 使用場景

### 1. 日內交易
- 使用分鐘K線（1m, 5m）觀察短期波動
- 切換日盤/夜盤時段分析不同時段特性
- 設定較少 K 棒數（20-50根）專注近期走勢

### 2. 波段交易
- 使用日K線配合 MA 指標捕捉趨勢
- 設定較多 K 棒數（100-200根）觀察中期走勢
- 自動過濾週末，圖表更清晰

### 3. 策略回測
- 切換不同週期驗證策略有效性
- 觀察均線交叉點位
- 分析成交量與價格關係

### 4. 盤勢監控
- 即時觀察最新收盤價與均線關係
- 成交量變化輔助判斷多空力道
- 深色主題降低長時間觀看疲勞

## 🔧 技術細節

### 資料處理流程

1. **數據下載**：使用 yfinance 從 Yahoo Finance 下載歷史數據
2. **時區轉換**：UTC → Asia/Taipei（台灣時間）
3. **欄位標準化**：統一為 Open, High, Low, Close, Volume
4. **時段過濾**：
   - 日盤：08:45-13:45
   - 夜盤：15:00-次日05:00
   - 全盤：不過濾
5. **非交易日移除**：日K 自動過濾週末
6. **技術指標計算**：
   - MA10 = Close.rolling(10).mean()
   - MA20 = Close.rolling(20).mean()
7. **數量限制**：取最新的 N 根 K 棒

### 效能優化

- **快取機制**：60秒內相同參數不重複下載
- **智能期間**：根據週期自動調整下載範圍
- **數量限制**：避免過多資料造成渲染延遲
- **條件渲染**：只在有數據時繪製圖表

## 🔄 未來規劃

- [ ] 整合 Shioaji API 接收即時 Tick 資料
- [ ] 新增更多技術指標（RSI, MACD, KD, 布林通道）
- [ ] 支援多商品對比分析（雙視窗比較）
- [ ] 新增策略回測功能與績效統計
- [ ] 加入自動交易訊號提示（均線交叉、突破訊號）
- [ ] 支援多時間框架分析（MTF）
- [ ] 加入警報功能（價格突破、指標交叉）
- [ ] 歷史數據匯出功能（CSV/Excel）

## ⚠️ 注意事項

1. **數據限制**：
   - Yahoo Finance 對分鐘線數據有時間限制
   - 建議使用日K查看長期走勢
   - 分鐘K適合觀察近期盤勢

2. **非即時數據**：
   - 目前使用的是歷史數據，延遲約15-20分鐘
   - 實戰交易請使用即時數據源（如 Shioaji）

3. **僅供學習**：
   - 本專案僅供教育和研究用途
   - 不構成投資建議
   - 實際交易請審慎評估風險

4. **模擬環境**：
   - 使用台灣加權指數模擬台指期
   - 實際交易請使用正式期貨數據

5. **效能考量**：
   - K棒數量過多可能影響渲染速度
   - 建議依需求調整顯示數量
   - 使用快取機制避免頻繁請求

## 🆕 更新日誌

### v2.0 (2026-01-13)
- ✅ 預設改為日K線圖
- ✅ 新增K棒數量控制滑桿（20-500根）
- ✅ 智能調整下載期間（根據週期）
- ✅ 自動過濾週末非交易日
- ✅ 修正 Streamlit 棄用警告
- ✅ 加入完整程式註解
- ✅ 更新 README 文件

### v1.0
- 初始版本
- 基本K線圖表功能
- MA10/MA20 技術指標
- 時段切換功能

## 📝 依賴套件

```txt
yfinance>=0.2.31
mplfinance>=0.12.10b0
pandas>=2.0.0
matplotlib>=3.7.0
shioaji[speed]>=1.0.0
pathlib>=1.0.1
streamlit
plotly
numpy
```

## 🤝 貢獻

歡迎提交 Issue 和 Pull Request 來改進這個專案！

## 📄 授權

本專案採用 MIT 授權條款

## 👨‍💻 開發者

本專案由 AI 助手協助開發完成

## 📧 聯絡資訊

如有問題或建議，歡迎透過 GitHub Issues 提出

---

**⚡ 快速開始：`streamlit run streamlit_run_app.py`**

**🎯 推薦設定：日K線 + 100根K棒 + 全盤時段**
